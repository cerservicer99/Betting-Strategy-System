# 自动投注策略系统功能

面向数字娱乐与彩票场景的自动化投注与策略平台，聚合“机器人引擎 + 多平台适配 + 策略模块 + 风控资金管理 + 数据报表 + Telegram 智能助手”。

## 产品亮点
- 自动化投研与执行：按策略自动识别形态、计算注额、发起下注、记录结果与盈亏
- 多平台即插即用：支持默认 GraphQL 平台与星欧（Xinou）REST 平台，统一接口抽象
- 策略灵活可配：内置多种策略（等待形态、马丁格尔、凯利、Win/Loss 等），可扩展
- 全面风控护航：止盈/止损、追踪止损、最大局数/连挂/连中等阈值一应俱全
- 数据可视化与报表：本地明细与平台数据双通道同步，支持小时/日维度报表
- 即时通知触达：Telegram 机器人提供每局通知、定时报表、邀请裂变与客服入口

## 关键能力
- 机器人引擎
  - 生命周期管理：初始化、启动、停止、状态恢复（resume）与重置（reset）
  - 核心循环：拉取开奖历史、策略评估、下注执行、结果校验、统计更新
  - 异常自愈：自动处理平台 Token 失效（如 10004），重登后重试
  - 下注智能参数：玩法识别、倍数反推或自动计算、实际金额校准与回写
  - 数据一致性：本地订单与平台订单双向校验，缺失时采用稳健估算回退
- 策略引擎
  - 形态识别：按“中/挂”历史序列判断是否触发下注
  - 资金管理：固定/比例调整、赢后重置/递增/递减、输后增加/倍投等
  - 可扩展注册中心：新增策略即插即用，支持 UI 配置 Schema
- 风控与安全
  - 止盈/止损/追踪止损：盈亏与最高点位联动，动态止损线
  - 运行约束：最大局数、最大连挂/连中、最长运行时长
  - 平台双因子：星欧平台支持谷歌验证码（TOTP）登录
- 平台适配
  - 平台工厂：GraphQL/REST（Xinou）一键切换，同一 Bot 接口
  - 会话管理：Cookie/Token 自动维护与刷新
- 报表与通知
  - 明细与汇总：投注记录、订单详情、余额同步、盈亏统计
  - Telegram：每局/小时/每日报表，个人中心、我的机器人、邀请链接、升级说明

## 典型应用场景
- 数字娱乐/彩票的自动化策略投研与执行
- 多平台账号托管与统一策略管理
- 面向代理/会员的分润与裂变增长
- 实时通知与经营看板（小时/日维度）

## 组成模块
- services/bot-engine：核心机器人引擎与循环决策
- strategies/*：策略基类与多种实现（PatternWait、Martingale、Kelly 等）
- services/platform-factory：平台适配工厂（GraphQL 与 Xinou）
- services/xinou-*：星欧平台 REST 集成（认证/游戏/用户）
- services/telegram/*：Telegram 命令、消息、调度与通知格式化
- models/*：Account/Strategy/Game/Gameplay/BotBet/User/Log 等业务模型
- index.js：HTTP API 网关（机器人控制、数据查询、报表接口等）

## 面向商务的价值
- 降本增效：自动化执行与异常自愈，显著降低人力介入
- 快速落地：平台抽象与策略模块化，支持定制与二次开发
- 合规与风控：完善的止盈/止损与运行约束，降低策略风险
- 增长与裂变：Telegram 一体化运营工具，拉新留存闭环


# 机器人引擎

机器人引擎负责“形态识别 → 决策下注 → 结果校验 → 统计更新 → 风控止停”的完整闭环，以高可靠与可扩展为核心设计。

## 核心流程
1. 初始化
   - 关联账号/平台/游戏/玩法/策略最新配置
   - 启动模式：重置（reset）或恢复（resume，读取 last_state）
   - 设置初始注额与统计对象（totalProfit、rounds、streak 等）
2. 监控循环
   - 获取开奖历史（当前期 + 历史序列）
   - 策略评估（evaluate）：是否满足下注形态
   - 命中形态时标记 betPending，进入“下注阶段”，否则继续监听
3. 下注执行
   - 智能玩法识别（组选 24/12 等）
   - 倍数反推或自动计算，确保“目标金额 → 实际金额”闭合
   - 发起下注并写入本地 BotBet（订单、金额、期号等）
4. 结果校验与统计
   - 同步平台订单记录，若缺失采用稳健估算（赔率兜底）
   - 更新盈亏与连中/连挂，写回 BotBet 与 Account 余额
   - 触发风控阈值则优雅停止（止盈/止损/连挂/最大局数）
5. 通知与可视化
   - 每局通知：Telegram 发送回合结果与累计统计
   - 最新状态缓存：供前端 UI 实时展示（策略、金额、形态、期号等）

## 异常自愈
- 平台会话失效（如 10004）：自动重新登录与重试
- 平台记录缺失：重试若仍缺失则采用估算值，保持统计连续性
- 策略热更新：数据库策略变动后可重载并生效

## 风控与资金管理
- 止盈/止损与追踪止损：按累计盈亏与最高点位动态止停
- 运行约束：最大局数、最大连挂/连中、最长运行时间
- 注额调整：固定/比例/倍投模式，支持“赢后重置/递增/递减/倍投”“输后增加/减少/倍投/重置”

## 可扩展性
- 策略实例化：通过注册中心加载实现类（implementations/*）
- 配置 Schema：策略可暴露前端配置表单字段
- 多平台抽象：统一 Bot 接口，支持 GraphQL 与 Xinou REST 平台

## 典型效果
- 自动追踪目标形态，精准命中与稳健止停
- 较低人工介入率，提升执行稳定性与策略一致性

## 联系方式
- **在线客服**: [@keep_watch](https://t.me/keep_watch) 可定制策略，请直入主题，无线上演示
 
![2026-02-02 17 19 43](https://github.com/user-attachments/assets/ed2c49ff-fc32-4bee-add9-d24f72a20c47)
![2026-02-02 17 19 39](https://github.com/user-attachments/assets/f3197d27-3c77-4cd5-99b0-ba44005460fe)
![2026-02-02 17 19 36](https://github.com/user-attachments/assets/ca527a59-70b4-45b0-a11b-333f52cccec2)

